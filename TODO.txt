
TODO
- add void, refund transactions for webhook with order status
- update transaction id for MOTO void and refund using webhook
- add the place order API (with MADA support)
- Handle refund in verify as in place order if order creation fails
- add shipping handling for instant payment, currently flatrate_flatrate not good
- save card checkbox to options and save card if needed after payment

- check auto invoice, capture and other settings for all methods (compare confix.ml and system.xml)

- add customer details to payment requests
- Replace APM id by title in list 
- set the payment type in all requests "Regular" "Recurring" "MOTO"
- set metadata with method id in all method payment requests (needed for handleOrder)
- check opened/closed transactions logic

TASKS
- do CLR to LF normalisation
- move common payment method functions to an abstract class
- update git ignore
- check deleted vault cards not removed from db
- check all translation strings
- Add instant purchase note in order somewhere
- move strings to constants and centralize definitions
- move the placeOrder calls in controllers to a centralised processOrder call in orderHandlerService (duplicated code in placeOrder and verify controllers)
- delegate all response checks to API handler isValidResponse($respoonse), especially APM method
- check multiple transactions storage logic in order payment details
- review the setPayment data in order save before and after ($response replaced py $payload)
- split transaction handler code in smaller chunks

OPTIONAL
- add advanced Frames localisation and style parameters?
- check after multiple failed requests (add idempotency?)
- add MOTO partial capture feature?
- add vault extra config parameter fields from config.xml + instant purchase control
- convert card icons to base 64 for account and vault list display
