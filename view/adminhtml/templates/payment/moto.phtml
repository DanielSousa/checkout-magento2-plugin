<fieldset class="admin__fieldset payment-method checkoutcom_moto" id="payment_form_checkoutcom_moto" style="display: none;">
    <br>
    <div id="cko-form-holder">
        <form class="widget-container" id="saveCardForm" method="POST">
            <input type="hidden" id="cko-card-token" name="cko-card-token">
        </form>
    </div>
</fieldset>

<script type="text/javascript">
    require(['jquery', 'domReady!', 'framesjs'], function ($) {
        // Prepare the elements
        var cardTokenField = $('#cko-card-token');
        var cardFormContainerId = '#cko-form-holder';
        var ckoPublicKey = '<?= $block->config->getValue('public_key'); ?>';
        var paymentForm = document.getElementById('saveCardForm');
        var ckoTheme = '';
        
        // Todo - Connect the  debug mode to config
        var ckoDebugMode = true;

        // Remove any existing event handlers
        Frames.removeAllEventHandlers(Frames.Events.CARD_VALIDATION_CHANGED);
        Frames.removeAllEventHandlers(Frames.Events.CARD_TOKENISED);
        Frames.removeAllEventHandlers(Frames.Events.FRAME_ACTIVATED);
            
        // Initialize the embedded form
        Frames.init({
            publicKey: ckoPublicKey,
            containerSelector: cardFormContainerId,
            theme: ckoTheme,
            debugMode: ckoDebugMode,
            cardValidationChanged: function(event) {
                if (Frames.isCardValid()) {
                    Frames.submitCard();
                    Frames.unblockFields();
                }
            },
            cardTokenised: function(event) {                        
                // Add the card token to the form
                Frames.addCardToken(paymentForm, event.data.cardToken);

                // Add the card token to the hidden input field
                cardTokenField.val(event.data.cardToken);
            }
        });  
    });
</script>